(()=>{"use strict";var e,t,n=function(e,t,n,o){return new(n||(n=Promise))((function(i,r){function s(e){try{a(o.next(e))}catch(e){r(e)}}function c(e){try{a(o.throw(e))}catch(e){r(e)}}function a(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,c)}a((o=o.apply(e,t||[])).next())}))};class o{constructor(e){this.courseRepo=e,this.isEnabled={autoSkip:!1},this.url={autoSkipHandler:""},this.initPlayerNodeObserver=()=>new MutationObserver((()=>{var e;this.isEnabled.autoSkip&&(null===(e=document.querySelector(".mantine-Modal-root"))||void 0===e||e.querySelectorAll("button").forEach((e=>{"다음 수업보기"!==e.innerText&&"다음 수업"!==e.innerText||e.click()})))})),this.setPlayerNodeObserver=()=>{if(!document.querySelector("video"))return;const e=document.querySelector(".mantine-Modal-root");e&&this.playerNodeObserver.observe(e,{childList:!0})},this.initAutoSkip=({button:e,url:t})=>n(this,void 0,void 0,(function*(){const n=e.getAttribute("id"),o=yield this.courseRepo.getAutoSkipIsEnabled(n);this.url.autoSkipHandler!==t&&(this.url.autoSkipHandler=t,this.playerNodeObserver&&this.playerNodeObserver.disconnect(),setTimeout((()=>{this.setPlayerNodeObserver()}),500)),this.isEnabled.autoSkip=o,this.setAutoSkipStyle({button:e,isEnabled:o})})),this.setAutoSkipStyle=({button:e,isEnabled:t})=>{t?(e.style.color="white",e.style.backgroundColor="rgb(0, 196, 113)",e.innerText="자동 재생중",e.setAttribute("data-button","true")):(e.style.color="rgb(0, 196, 113)",e.style.backgroundColor="transparent",e.innerText="자동 재생",e.setAttribute("data-button","false"))},this.autoSkipHandler=({id:e,isEnabled:t})=>(this.courseRepo.setAutoSkipIsEnabled(e,t),this.isEnabled.autoSkip=t,{isEnabled:this.isEnabled.autoSkip}),this.initSpeed=({controller:e,videoEle:t})=>n(this,void 0,void 0,(function*(){if(null===t)return;const n=e.id;let o=yield this.courseRepo.getVideoSpeed(n);null===o&&(o=t.playbackRate,this.courseRepo.setVideoSpeed(n,o)),t.playbackRate=o,this.setSpeedDiv({controller:e,playbackRate:o})})),this.setSpeedDiv=({controller:e,playbackRate:t})=>{const n=e.querySelector("div");n&&(n.innerText=t.toString()+"X")},this.speedHandler=({isUp:e,videoEle:t,controller:n})=>{let o=t.playbackRate;o=.25*Math.floor(o/.25),o=e?o+.25>5?5:o+.25:o-.25<.5?.5:o-.25,t.playbackRate=o;const i=n.id;this.courseRepo.setVideoSpeed(i,o),this.setSpeedDiv({controller:n,playbackRate:o})},this.playerNodeObserver=this.initPlayerNodeObserver()}}e=o,o.getInstance=t=>(e.instance||(e.instance=new o(t)),e.instance);class i{constructor(){this.searchMyCourse=e=>{if(0===e.length)return;const t=encodeURI(`https://www.inflearn.com/my-courses?s=${e}`);window.location.href=t}}}t=i,i.getInstance=()=>(t.instance||(t.instance=new i),t.instance);var r,s=function(e,t,n,o){return new(n||(n=Promise))((function(i,r){function s(e){try{a(o.next(e))}catch(e){r(e)}}function c(e){try{a(o.throw(e))}catch(e){r(e)}}function a(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,c)}a((o=o.apply(e,t||[])).next())}))};class c{constructor(e){this.courseService=e,this.initAutoSkip=({button:e,url:t})=>s(this,void 0,void 0,(function*(){try{yield this.courseService.initAutoSkip({button:e,url:t})}catch(e){console.warn(e)}})),this.autoSkipHandler=({button:e})=>s(this,void 0,void 0,(function*(){const t=e.getAttribute("id"),n="false"!==e.getAttribute("data-button");try{const o=this.courseService.autoSkipHandler({id:t,isEnabled:!n});this.courseService.setAutoSkipStyle({button:e,isEnabled:o.isEnabled})}catch(e){console.warn(e)}})),this.initSpeed=({controller:e,videoEle:t})=>s(this,void 0,void 0,(function*(){try{if(!t)return;yield this.courseService.initSpeed({controller:e,videoEle:t})}catch(e){console.warn(e)}})),this.speedHandler=({isUp:e,controller:t})=>s(this,void 0,void 0,(function*(){try{const n=document.querySelector("video");if(!n)return;this.courseService.speedHandler({isUp:e,videoEle:n,controller:t})}catch(e){console.warn(e)}}))}}r=c,c.getInstance=e=>(r.instance||(r.instance=new c(e)),r.instance);var a,l,u=function(e,t,n,o){return new(n||(n=Promise))((function(i,r){function s(e){try{a(o.next(e))}catch(e){r(e)}}function c(e){try{a(o.throw(e))}catch(e){r(e)}}function a(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,c)}a((o=o.apply(e,t||[])).next())}))};class d{get id(){return this._id}constructor(e){this.courseController=e,this.button={autoSkip:!1},this._id={autoSkip:"inflearn-extra-course-auto_skip",videoSpeed:"inflearn-extra-course-video_speed"},this.autoSkip=e=>u(this,void 0,void 0,(function*(){const t=this._id.autoSkip;let n=document.querySelector(`#${t}`);n||(n=this.createAutoSkpButton(e)),this.courseController.initAutoSkip({button:n,url:e})})),this.createAutoSkpButton=e=>{const t=this._id.autoSkip,n=document.createElement("button");return n.id=t,n.type="button",n.style.height="36px",n.style.marginLeft="8px",n.style.fontSize="14px",n.style.border="none",n.style.fontWeight="500",n.style.borderRadius="8px",n.style.border="1px solid rgb(0, 196, 113)",n.style.padding="0px 5px",n.style.fontFamily='retendard, -apple-system, BlinkMacSystemFont, system-ui, Roboto, "Helvetica Neue", "Segoe UI", "Apple SD Gothic Neo", "Noto Sans KR", "Malgun Gothic", "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", sans-seri',n.style.width="100px",n.addEventListener("click",(()=>{this.courseController.autoSkipHandler({button:n})})),document.querySelector(".mantine-Group-root").prepend(n),this.button.autoSkip=!0,n},this.videoSpeed=()=>u(this,void 0,void 0,(function*(){const e=this._id.videoSpeed;let t=document.querySelector(`#${e}`);t||(t=this.createVideoSpeedButton()),setTimeout((()=>{const e=document.querySelector("video");this.courseController.initSpeed({controller:t,videoEle:e})}),500)})),this.createVideoSpeedButton=()=>{const e=this._id.videoSpeed,t=document.createElement("div");t.id=e,t.setAttribute("data-speed","1"),t.style.display="flex",t.style.height="36px",t.style.color="white",t.style.alignItems="center",t.style.justifyContent="center",t.style.fontSize="15px",t.style.border="1px solid rgb(0, 196, 113)",t.style.padding="0px 0px",t.style.borderRadius="8px",t.style.fontFamily='retendard, -apple-system, BlinkMacSystemFont, system-ui, Roboto, "Helvetica Neue", "Segoe UI", "Apple SD Gothic Neo", "Noto Sans KR", "Malgun Gothic", "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", sans-seri';const n=document.createElement("button");n.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">\n\t\t<path stroke-linecap="round" stroke-linejoin="round" d="M4.5 15.75l7.5-7.5 7.5 7.5" />\n\t</svg>',n.style.backgroundColor="transparent",n.style.border="none",n.style.padding="3px",n.style.display="flex",n.style.justifyContent="center",n.style.alignItems="center";const o=n.querySelector("svg");o.style.height="25px",o.style.fill="transparent",o.style.stroke="rgb(0, 196, 113)";const i=document.createElement("button");i.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">\n\t\t<path stroke-linecap="round" stroke-linejoin="round" d="M19.5 8.25l-7.5 7.5-7.5-7.5" />\n\t</svg>\n\t',i.style.backgroundColor="transparent",i.style.border="none",i.style.padding="3px",i.style.display="flex",i.style.justifyContent="center",i.style.alignItems="center";const r=i.querySelector("svg");r.style.height="25px",r.style.fill="transparent",r.style.stroke="rgb(0, 196, 113)";const s=document.createElement("div");return s.style.width="35px",s.style.textAlign="center",n.addEventListener("click",(()=>{this.courseController.speedHandler({isUp:!0,controller:t})})),i.addEventListener("click",(()=>{this.courseController.speedHandler({isUp:!1,controller:t})})),t.appendChild(i),t.appendChild(s),t.appendChild(n),document.querySelector(".mantine-Group-root").prepend(t),t}}}a=d,d.getInstance=e=>(a.instance||(a.instance=new d(e)),a.instance);class h{constructor(e){this.homeService=e,this.searchMyCourse=({searchDiv:e})=>{try{const t=e.querySelector("input").value;this.homeService.searchMyCourse(t)}catch(e){console.warn(e)}}}}l=h,h.getInstance=e=>(l.instance||(l.instance=new h(e)),l.instance);var p;class y{constructor(e){this.homeController=e,this.id={searchMyCourse:"inflearn-extra-home-search_my_course"},this.searchMyCourse=()=>{return e=this,t=void 0,o=function*(){const e=this.id.searchMyCourse;document.querySelector(`#${e}`)||this.createSearchMyCourseEle()},new((n=void 0)||(n=Promise))((function(i,r){function s(e){try{a(o.next(e))}catch(e){r(e)}}function c(e){try{a(o.throw(e))}catch(e){r(e)}}function a(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,c)}a((o=o.apply(e,t||[])).next())}));var e,t,n,o},this.createSearchMyCourseEle=()=>{const e=document.createElement("div");e.id=this.id.searchMyCourse,e.className="search search_bar navbar-item header_search",e.innerHTML='\n    <label class="visually-hidden" for="searchbar-input">내 강의 검색</label>\n    <input type="text" id="mycourse-searchbar-input" enterkeyhint="go" class="input" placeholder="내 강의 검색" data-kv="headerSearchWord">\n    <div class="search__icon e-header-search"><i class="far fa-search"></i></div>\n  ';const t=e.querySelector("input");return t.style.backgroundColor="rgb(216, 255, 239)",document.querySelector(".navbar-right").prepend(e),document.querySelector("div").addEventListener("click",(()=>{this.homeController.searchMyCourse({searchDiv:e})})),t.addEventListener("keydown",(t=>{"Enter"===t.key&&this.homeController.searchMyCourse({searchDiv:e})})),e}}}p=y,y.getInstance=e=>(p.instance||(p.instance=new y(e)),p.instance);var v,S=function(e,t,n,o){return new(n||(n=Promise))((function(i,r){function s(e){try{a(o.next(e))}catch(e){r(e)}}function c(e){try{a(o.throw(e))}catch(e){r(e)}}function a(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,c)}a((o=o.apply(e,t||[])).next())}))};class f{constructor(){this.getStorage=e=>new Promise((t=>{chrome.storage.sync.get([e],(n=>{t(n[e]?JSON.parse(n[e]):null)}))})),this.setStorage=(e,t)=>S(this,void 0,void 0,(function*(){return chrome.storage.sync.set({[e]:JSON.stringify(t)})})),this.getConfig=()=>S(this,void 0,void 0,(function*(){return this.getStorage("inflearn-extra-config")})),this.setConfig=e=>S(this,void 0,void 0,(function*(){yield this.setStorage("inflearn-extra-config",e)}))}}v=f,f.getInstance=()=>(v.instance||(v.instance=new f),v.instance);class g{}var b,m=function(e,t,n,o){return new(n||(n=Promise))((function(i,r){function s(e){try{a(o.next(e))}catch(e){r(e)}}function c(e){try{a(o.throw(e))}catch(e){r(e)}}function a(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,c)}a((o=o.apply(e,t||[])).next())}))};class k extends g{constructor(){super(...arguments),this.getStorage=e=>new Promise((t=>{chrome.storage.sync.get([e],(n=>{t(n[e]?JSON.parse(n[e]):null)}))})),this.setStorage=(e,t)=>m(this,void 0,void 0,(function*(){return chrome.storage.sync.set({[e]:JSON.stringify(t)})})),this.getAutoSkipIsEnabled=e=>m(this,void 0,void 0,(function*(){let t=yield this.getStorage(e);return null===t&&(this.setAutoSkipIsEnabled(e,!1),t=!1),t})),this.setAutoSkipIsEnabled=(e,t)=>m(this,void 0,void 0,(function*(){yield this.setStorage(e,t)})),this.getVideoSpeed=e=>m(this,void 0,void 0,(function*(){let t=yield this.getStorage(e);return null===t&&(this.setVideoSpeed(e,1),t=1),t})),this.setVideoSpeed=(e,t)=>m(this,void 0,void 0,(function*(){yield this.setStorage(e,t)}))}}b=k,k.getInstance=()=>(b.instance||(b.instance=new k),b.instance);let w=!1,x="";chrome.runtime.onMessage.addListener(((e,t,n)=>{return r=void 0,s=void 0,l=function*(){const t=new URL(e.url);if(w&&x===e.url)return;const n=yield f.getInstance().getConfig().then((e=>{const t={};return[""].forEach((e=>{t[e]=!1})),null===e?t:e}));if(document.querySelector("#searchbar-input")){const e=y.getInstance(h.getInstance(i.getInstance()));if(null===n)return void(yield e.searchMyCourse());n["home-search_my_course"]&&(yield e.searchMyCourse())}else if(t.pathname.includes("/course/lecture")){const t=d.getInstance(c.getInstance(o.getInstance(k.getInstance())));if(null===n)return;n["course-auto_skip"]&&(yield t.autoSkip(e.url)),n["course-video_speed"]&&(yield t.videoSpeed())}x=e.url,w=!0},new((a=void 0)||(a=Promise))((function(e,t){function n(e){try{i(l.next(e))}catch(e){t(e)}}function o(e){try{i(l.throw(e))}catch(e){t(e)}}function i(t){var i;t.done?e(t.value):(i=t.value,i instanceof a?i:new a((function(e){e(i)}))).then(n,o)}i((l=l.apply(r,s||[])).next())}));var r,s,a,l}))})();